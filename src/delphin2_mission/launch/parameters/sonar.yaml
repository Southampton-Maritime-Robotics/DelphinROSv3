# Parameters for the MICRON and SEAKING sonar
# used for running the sonar on the vehicle

######################################################
# Sonar Settings
######################################################

# Drift offset, should it ever occur again!
# A drift offset of 90 means that the data that is currently measured at 90 degrees
# will now be used at 0 degrees
# in degrees, from 0 to 359
sonar/Driftoffset: 0


# Left limit for Heading
# in degrees, from 0 to 359
sonar/LLim: 0

# Right limit for Heading
# in degrees, from 0 to 359
sonar/RLim: 301

# Number of sample bins over scan-line
# Max for SeaKing/SeaPrince/MiniKing/Micron: 800
# New digital DST sonar products: 1500
# see delphin2_sonar_micron_*.pdf in the datasheets
# more bins = more resolution, more noise
# 300 bins is about the upper limit of the visualisation
sonar/NBins: 200

# Samping interval of each range bin
# usually not used, since Range is used to calculate this 
# in units of [640 nanoseconds]
sonar/ADInterval: 5

# Range
# used to calculate the ADInterval
# in [metres]
sonar/Range: 5

# not used in 8 bit mode
sonar/ADSpan:  210
sonar/ADLow: 0

# Initial gain for channel 1
sonar/IGainB1: 84
# Initial gain for channel 2
sonar/IGainB2: 84

# High-speed limit of scanning motor
# in [10 microseconds]
sonar/MoTime: 25
# Step resolution of scanning motor
# in [16th of a gradian]
# defaults: 32=1.8 degrees, 16, 8, 4
# 64 used in all Delphin2 sonar applications before 2016
sonar/Step: 64

#######################################################
# Analysis and evaluation
# Used both on the vehicle and in post processing
#######################################################

# Number of repeated returns (+1 from SonarPing.m) to remove glitches
sonar/analyse/GlitchCount: 1

# Power level (0 to 250) above which sonar 'sees' a target
# Value above which somethign is considered an object of interest
sonar/analyse/Threshold: 80

# Distance at which an obstacle is considered in the sonar range
# (a larger range is kept for monitoring)
# This shold be smaller or equal to sonar/Range
sonar/analyse/ObstacleRange: 4

# Blanking distance to remove returns from the sonar mount
# Distance from sonar head withing which returns are ignored
# probably in [metres]
sonar/analyse/BlankDist: 0.6

######################################################
# Visualisation 
######################################################

# maximum number of measurements that are considered/shown in a plot
/sonar/plot/Memory: 200

# specific angle for which target range should be plotted
/sonar/plot/AngleOfInterest: 100


######################################################
# Communication protocol
######################################################
# these settings are needed for use in the serial protocol,
# but either they are just part of the serial protocol
# or it is not specified clearly what they do
#

# Serial Port Settings
# on delphin2 the port is /dev/ttyS3
# on a laptop this may vary, e.g. /dev/ttyUSB0
# the baudrate should not be changed, since it needs to be the same setting on computer and sonar
# sonar/serial/Port: '/dev/ttyUSB0'
sonar/serial/Port: '/dev/ttyS3'
sonar/serial/Baudrate: 115200

# Timeout for reading sonar data after sonar ping message
sonar/serial/ReadTimeout: 2

# Receive error count from which the sonar communication is considererd as failed
# and the serial communication is reset
sonar/serial/CriticalErrorCount: 5

# head Type selection
# 1 for MICRON, 29 for SEAKING
sonar/serial/HeadType: 1

# Source transmission node (documentation value: 155 (0xFF))
sonar/serial/SID: 255

# Msg destination node (documentation value: 02 (0x02))
sonar/serial/DID: 2

# Repeat of SID (not what it sais in the manual!)
sonar/serial/Node: 255

#
# HdCtrl bytes
# see datasheets delphin2_sonar_micron_*.pdf
# this assembles to 0010001100000101
# which means: adc8on = 1, cont = 0, scanright = 1, invert = 0, motoff = 0, etc. (from here as defaults)
# most significant bit: left most bit
sonar/serial/HdCtrl1: '00000101'
sonar/serial/HdCtrl2: '00100011'

# set as Imagign Sonar, DST head type
sonar/serial/DstHead: 11

# Default 500, no further explanation given
sonar/serial/MaxADBuf: 500
# Blanking interval, default 100
# in [microseconds]
sonar/serial/Lockout: 100
# Default 1600 for single channel, no further explanation given
sonar/serial/MinorAxis: 1600
# Default 1 for single channel, no further explanation given
sonar/serial/MajorAxis: 1
